novo cod
Maria Eduarda<mariaeduardajs00@gmail.com>
‚Äã
Melissa Oliveira1 25011962‚Äã
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Reconhecimento IA - Profissional</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

<style>
/* Tela cheia e fundo vibrante */
#final-screen {
  display: none;
  width: 100vw;
  height: 100vh;
  background: radial-gradient(circle at top left, #1f3c88, #2ad1a2, #ff6f3c);
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 40px;
  gap: 30px;
  text-align: center;
  overflow-y: auto;
}

/* Mostrar com anima√ß√£o */
#final-screen.active {
  display: flex;
  animation: fadeInScreen 1s ease forwards;
}

@keyframes fadeInScreen {
  from {opacity:0; transform: scale(0.95);}
  to {opacity:1; transform: scale(1);}
}

/* T√≠tulo grande com glow pulsante */
#final-screen h1 {
  font-size: 4em;
  font-weight: 900;
  text-shadow: 0 0 20px #fff, 0 0 40px #ffd93b, 0 0 60px #ff6f3c;
  animation: glowTitle 2s infinite alternate;
}

@keyframes glowTitle {
  0% { text-shadow: 0 0 20px #fff, 0 0 40px #ffd93b, 0 0 60px #ff6f3c; }
  50% { text-shadow: 0 0 40px #fff, 0 0 60px #ffd93b, 0 0 80px #ff6f3c; }
  100% { text-shadow: 0 0 20px #fff, 0 0 40px #ffd93b, 0 0 60px #ff6f3c; }
}

/* Resumo final */
.final-summary p {
  font-size: 2em;
  font-weight: 700;
  margin: 0 20px;
  color: #ffd93b;
  text-shadow: 0 0 10px #fff;
}

/* Galeria din√¢mica em grid */
#final-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  width: 95%;
  margin-top: 20px;
}

/* Cards de cada foto */
#final-gallery .item {
  background: linear-gradient(135deg, #2ad1a2, #ff6f3c);
  border-radius: 20px;
  padding: 12px;
  text-align: center;
  color: #fff;
  font-weight: 700;
  font-size: 1.2em;
  box-shadow: 0 0 20px #ffd93b, 0 0 30px #ff6f3c inset;
  transform: scale(0);
  animation: popIn 0.6s forwards;
}

@keyframes popIn {
  from {transform: scale(0); opacity:0;}
  to {transform: scale(1); opacity:1;}
}

/* Imagens com glow */
#final-gallery img {
  width: 100%;
  border-radius: 15px;
  margin-bottom: 8px;
  box-shadow: 0 0 20px #fff, 0 0 30px #ffd93b inset;
  object-fit: cover;
}

/* Labels das emo√ß√µes */
#final-gallery .label {
  font-size: 1.2em;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 0 5px #000;
}

/* Bot√£o refazer teste */
#final-screen .start-btn {
  padding: 20px 60px;
  font-size: 1.8em;
  font-weight: 900;
  background: #ff6f3c;
  color: #fff;
  border-radius: 50px;
  box-shadow: 0 0 30px #ffd93b, 0 0 50px #ff6f3c inset;
  transition: all 0.3s ease;
}

#final-screen .start-btn:hover {
  transform: scale(1.2);
  box-shadow: 0 0 50px #ffd93b, 0 0 80px #ff6f3c inset;
}
#confetti-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* n√£o atrapalha cliques */
  z-index: 10; /* fica acima do fundo mas atr√°s do conte√∫do */
}

:root {
  --primary: #1f3c88;
  --secondary: #2ad1a2;
  --accent: #ff6f3c;
  --accent-hover: #ffd93b;
  --bg: #f0f8ff;
  --text: #333;
  --card-bg: #fff;
  --label: #2ad1a2;
}

* { box-sizing: border-box; margin:0; padding:0; font-family: 'Fredoka', sans-serif; }
body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; min-height:100vh; }

header {
  width: 100%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  padding: 25px 0;
  text-align: center;
  font-size: 2.2em;
  font-weight: 700;
  color: #fff;
  border-radius: 0 0 30px 30px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
}

/* Hero */
.hero-section { display: flex; flex-wrap: wrap; justify-content:center; align-items:center; max-width:950px; width:100%; margin-top:30px; background: var(--card-bg); padding:40px; border-radius:30px; box-shadow:0 15px 35px rgba(31,60,136,0.15);}
.hero-text { flex:1; min-width:280px; }
.hero-text h2 { font-size:3em; color: var(--primary); margin-bottom:15px; }
.hero-text h2 span { color: var(--accent); animation: colorpulse 3s infinite alternate; }
@keyframes colorpulse {0%{color:#ff6f3c;}50%{color:#ffd93b;}100%{color:#2ad1a2;}}
.hero-text p { font-size:1.3em; margin-bottom:30px; line-height:1.6; }
#username { font-size:1.4em; padding:12px; border-radius:10px; border:1px solid #ccc; margin-bottom:12px; width:80%; }
.hero-main-image { max-width:400px; width:100%; height:280px; object-fit:cover; border-radius:25px; box-shadow:0 15px 30px rgba(31,60,136,0.2); transition: transform 0.5s; }
.hero-main-image:hover { transform: scale(1.05) rotate(-1deg); }
.start-btn { background: var(--accent); color:#fff; font-size:1.3em; font-weight:700; padding:18px 50px; border-radius:35px; border:none; cursor:pointer; box-shadow:0 10px 20px rgba(255,111,60,0.5); transition: all 0.3s; }
.start-btn:hover { background: var(--accent-hover); color: var(--primary); transform: scale(1.1); box-shadow:0 12px 25px rgba(255,217,59,0.5); }

/* Ranking container */
#ranking {
  margin-top: 25px;
  width: 100%;
  max-width: 950px;
  background: var(--card-bg);
  padding: 25px;
  border-radius: 25px;
  box-shadow: 0 15px 35px rgba(31,60,136,0.1);
}

/* T√≠tulo do ranking */
#ranking h3 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 2em;
  font-weight: 700;
  color: var(--primary);
}

/* Lista */
#ranking ol {
  list-style: none;
  padding: 0;
}

/* Itens do ranking */
#ranking li {
  background: #f9f9f9;
  margin-bottom: 12px;
  padding: 14px 20px;
  border-radius: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 1.2em;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  transition: transform 0.3s ease, background 0.3s ease;
}

/* Hover nos itens */
#ranking li:hover {
  transform: scale(1.03);
  background: #fff8e6;
}

/* Medals para os 3 primeiros */
#ranking li.gold { background: #ffd70033; }    /* dourado transl√∫cido */
#ranking li.silver { background: #c0c0ff33; }  /* prateado transl√∫cido */
#ranking li.bronze { background: #cd7f3233; }  /* bronze transl√∫cido */

/* Bot√£o remover */
#ranking li span.remove {
  color: #ff4b4b;
  font-size: 0.9em;
  cursor: pointer;
  margin-left: 10px;
  transition: color 0.2s ease;
}

#ranking li span.remove:hover {
  color: #d90000;
}

/* Anima√ß√£o de entrada */
@keyframes slideIn {
  from { transform: translateX(-20px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Anima√ß√£o de remo√ß√£o suave */
#ranking li.removing {
  opacity: 0;
  transform: scale(0.8);
  height: 0;
  margin: 0;
  padding: 0 20px;
  transition: all 0.4s ease;
}


/* Anima√ß√£o de subida */
#ranking li.up {
  animation: jump 0.6s ease forwards, glow 0.6s ease forwards;
}

@keyframes jump {
  0% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
  60% { transform: translateY(0); }
  100% { transform: translateY(0); }
}

@keyframes glow {
  0% { box-shadow: 0 0 5px rgba(255,255,0,0.3); }
  50% { box-shadow: 0 0 20px rgba(255,255,0,0.8); }
  100% { box-shadow: 0 0 5px rgba(255,255,0,0.3); }
}



/* Carrossel */
.image-carousel { width:100%; max-width:950px; margin:26px auto 0; background:var(--card-bg); border-radius:25px; box-shadow:0 10px 25px rgba(31,60,136,0.1); overflow:hidden; position:relative; }
.image-carousel-track { display:flex; transition: transform 0.8s ease; }
.image-carousel img { width:220px; height:140px; object-fit:cover; margin:5px; border-radius:14px; box-shadow:0 6px 18px rgba(13,31,64,.1); transition: all 0.3s; filter: blur(2px); opacity:0.7; }
.image-carousel img.active { filter: blur(0); opacity:1; transform: scale(1.05); }
.carousel-btn { position:absolute; top:50%; transform:translateY(-50%); background:rgba(31,60,136,.2); border:none; padding:10px; cursor:pointer; border-radius:50%; font-size:1.5rem; color:#fff; transition:0.2s; }
.carousel-btn:hover { background: rgba(31,60,136,.4); }
.carousel-prev { left:10px; }
.carousel-next { right:10px; }

/* Webcam e painel */
#modelo { display:none; margin-top:50px; max-width:950px; width:100%; background:var(--card-bg); padding:40px; border-radius:25px; box-shadow:0 15px 35px rgba(31,60,136,0.1); position:relative; }
#modelo.active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 30px;

  margin-top: -20px; /* üî• sobe todo o quadrado da webcam */
}
.webcam-section { display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-start; gap:30px; width:100%; position:relative; }
#webcam-container { border:4px dashed var(--label); padding:10px; border-radius:25px; background:#e6f9f6; box-shadow:0 10px 25px rgba(42,209,162,0.3); transition: all 0.5s ease; display:flex; justify-content:center; align-items:center;}
#webcam-container.correct { border-color:#2ad13f; box-shadow:0 12px 30px rgba(42,209,63,0.5);}
#webcam-container.wrong { border-color:#ff3c3c; box-shadow:0 12px 30px rgba(255,60,60,0.5);}
#webcam-container.capturing { border-color:#ffd93b; box-shadow:0 12px 30px rgba(255,217,59,0.5);}
canvas { border-radius:20px; width:560px !important; height:360px !important; }
.emotion-panel { display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; min-width:220px; position:relative; }
#current-emotion { font-size:3em; font-weight:700; color:var(--accent); text-align:center; }
#score-display { font-size:1.5em; font-weight:600; color:var(--primary); }

/* Feedback grande */
#feedback { font-size:2em; font-weight:700; transition: all 0.5s; text-align:center; height:60px; }
#feedback.correct { color:#2ad13f; animation: pop 0.6s; }
#feedback.wrong { color:#ff3c3c; animation: pop 0.6s; }
@keyframes pop { 0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);} }

/* Barra de progresso */
#progress-container { width:100%; max-width:950px; background:#ddd; border-radius:20px; overflow:hidden; margin-top:15px; }
#progress-bar { width:0%; height:18px; background:var(--accent); transition: width 0.5s ease; border-radius:20px; }

/* Resultado final */
#final-screen { display:none; flex-direction:column; align-items:center; justify-content:center; gap:25px; text-align:center; padding:50px; }
#final-screen.active { display:flex; animation:fadeIn 1s ease forwards; }
#final-screen h2 { font-size:3em; color:var(--primary); }
#final-screen p { font-size:1.5em; color:var(--secondary); }
#final-screen .start-btn { padding:20px 60px; font-size:1.5em; }

@keyframes fadeIn { from {opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }

@media(max-width:768px){ .webcam-section{flex-direction:column;} canvas{width:100% !important;height:auto !important;} }
</style>
</head>

<body>
<header>Reconhecimento IA ü§ñ</header>

<section class="hero-section" id="inicio">
<div class="hero-text">
  <h2>Sinta o poder da <span>intelig√™ncia artificial</span> üí°</h2>
  <p>Nosso projeto usa a Teachable Machine para reconhecer imagens em tempo real usando sua webcam. Ideal para educa√ß√£o, aprendizado e divers√£o.</p>
  <input type="text" id="username" placeholder="Digite seu nome" />
  <button class="start-btn" id="start-btn">Come√ßar üöÄ</button>

</div>
<img src="https://cdn.pixabay.com/photo/2023/04/06/15/11/artificial-intelligence-7904390_1280.jpg" alt="Imagem Principal IA" class="hero-main-image" />
</section>

<div id="ranking">
  <h3>Ranking</h3>
  <ol id="ranking-list"></ol>
</div>

<main id="modelo">
<div class="webcam-section">
  <div id="webcam-container">
   </div>
  </div>
  <div class="emotion-panel">
    <div id="current-emotion">üòÑ ALEGRIA</div>
    <div id="score-display">Pontua√ß√£o: 0</div>
    <div id="feedback"></div>
  </div>
</div>
<div id="progress-container"><div id="progress-bar"></div></div>
</main>

<div id="final-screen">
   <canvas id="confetti-canvas"></canvas> 
  <h2>üéâ UAU! Voc√™ concluiu! üéâ</h2>
  <p id="final-score">Pontua√ß√£o final: 0</p>
  <p id="final-time">Tempo total: 0 segundos</p>
  <div class="image-carousel" id="final-carousel">
    <button class="carousel-btn carousel-prev">&#10094;</button>
    <div class="image-carousel-track" id="final-carousel-track"></div>
    <button class="carousel-btn carousel-next">&#10095;</button>
  </div>

  <div id="final-gallery" class="gallery"></div>

  <button class="start-btn" onclick="location.reload()">Refazer Teste üîÅ</button>
</div>

<audio id="click-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f95c602d48.mp3?filename=click-124467.mp3" preload="auto"></audio>

<script>
const clickSound = document.getElementById('click-sound');
const startBtn = document.getElementById('start-btn');
const modeloSection = document.getElementById('modelo');
const inicioSection = document.getElementById('inicio');
const currentEmotion = document.getElementById('current-emotion');
const scoreDisplay = document.getElementById('score-display');
const feedback = document.getElementById('feedback');
const webcamContainer = document.getElementById('webcam-container');
const finalScreen = document.getElementById('final-screen');
const finalScore = document.getElementById('final-score');
const finalTime = document.getElementById('final-time');
const progressBar = document.getElementById('progress-bar');
let currentEmotions = []


const finalCarouselTrack = document.getElementById('final-carousel-track');
const carouselPrev = document.querySelector('.carousel-prev');
const carouselNext = document.querySelector('.carousel-next');

let username = '';
const emotionsToTest = ["alegria","tristeza","raiva","nojo","medo"];
const emotionEmojis = { alegria:"üòÑ", tristeza:"üò¢", raiva:"üò°", nojo:"ü§¢", medo:"üò±"};
let currentEmotionIndex = 0, score = 0, startTime;
let capturedImages = [];

async function init() {
  const usernameInput = document.getElementById('username');
  if (!usernameInput.value.trim()) { 
    alert("Digite seu nome para come√ßar!"); 
    return; 
  }
  username = usernameInput.value.trim();
  clickSound.play();
  startBtn.disabled = true;
  startBtn.innerHTML = `Carregando...`;

  try {
    const URL = "https://mellz980.github.io/projetofecart2025/";
    const model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    const webcam = new tmImage.Webcam(560, 360, true);
    await webcam.setup();
    await webcam.play();

  webcamContainer.innerHTML = "";
webcamContainer.appendChild(webcam.canvas);

// loop para manter a c√¢mera atualizada
async function loop() {
  webcam.update(); // redesenha sempre
  requestAnimationFrame(loop); // chama de novo no pr√≥ximo frame
}
loop();


    // Ocultar tela inicial e ranking
    inicioSection.style.display = "none";
    document.querySelector("header").style.display = "none";
    modeloSection.classList.add('active');
    document.getElementById('ranking').style.display = 'none';

    // Preparar teste
    startTime = Date.now();
    score = 0;
    capturedImages = [];

    // Embaralhar emo√ß√µes
   // Embaralhar emo√ß√µes (corrigido: usa a vari√°vel global!)
currentEmotions = shuffleArray([...emotionsToTest]).slice(0,5);


    currentEmotionIndex = 0;
    progressBar.style.width = '0%';

    // Iniciar teste
    runEmotionTest(webcam, model);
  } catch (err) {
    alert("Erro: " + err.message);
    startBtn.disabled = false;
    startBtn.innerHTML = "Come√ßar üöÄ";
  }
}

async function runEmotionTest(webcam, model) {
  if (currentEmotionIndex >= currentEmotions.length) {
  const totalTime = Math.floor((Date.now() - startTime) / 1000);
  showFinalScreen(totalTime);
  updateRanking(username, score); // ‚úÖ correto
  return;
}

  const expected = currentEmotions[currentEmotionIndex];
  currentEmotion.textContent = `${emotionEmojis[expected]} ${expected.toUpperCase()}`;
  feedback.textContent = "";
  webcamContainer.classList.add('capturing');

  // Tempo da emo√ß√£o: primeira 10s, demais 7s
  const waitTime = currentEmotionIndex === 0 ? 4000 : 3000;

  await new Promise(r => setTimeout(r, 1500)); // anima√ß√£o inicial
  webcam.update();
  const prediction = await model.predict(webcam.canvas);
  const imageData = webcam.canvas.toDataURL('image/png');
  capturedImages.push({ src: imageData, emotion: expected });

  const correct = prediction.some(p => p.className.toLowerCase() === expected && p.probability >= 0.8);

  if (correct) {
    feedback.textContent = `‚úÖ Acertou! +200 pontos`;
    feedback.classList.add('correct');
    feedback.classList.remove('wrong');
    webcamContainer.classList.add('correct');
    webcamContainer.classList.remove('wrong');
    score += 200;
  } else {
    feedback.textContent = `‚ùå Errou!`;
    feedback.classList.add('wrong');
    feedback.classList.remove('correct');
    webcamContainer.classList.add('wrong');
    webcamContainer.classList.remove('correct');
  }

  scoreDisplay.textContent = "Pontua√ß√£o: " + score;
  progressBar.style.width = `${Math.floor((currentEmotionIndex + 1) / emotionsToTest.length * 100)}%`;
  webcamContainer.classList.remove('capturing');

  setTimeout(() => {
    feedback.textContent = "";
    webcamContainer.classList.remove('correct', 'wrong');
    currentEmotionIndex++;
    runEmotionTest(webcam, model);
  }, waitTime);
}
function shuffleArray(array){
  for(let i = array.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}
function startConfetti() {
  const canvas = document.getElementById('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const confettiCount = 150;
  const confetti = [];

  const colors = ['#ff6f3c', '#ffd93b', '#2ad1a2', '#ffffff'];

  for(let i=0;i<confettiCount;i++){
    confetti.push({
      x: Math.random() * canvas.width,
      y: Math.random() * -canvas.height,
      r: Math.random() * 6 + 4,
      d: Math.random() * confettiCount,
      color: colors[Math.floor(Math.random()*colors.length)],
      tilt: Math.random() * 10 - 10,
      tiltAngleIncrement: Math.random() * 0.07 + 0.05,
      tiltAngle: 0
    });
  }

  function drawConfetti(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach((c)=>{
      ctx.beginPath();
      ctx.lineWidth = c.r / 2;
      ctx.strokeStyle = c.color;
      ctx.moveTo(c.x + c.tilt + c.r / 4, c.y);
      ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r / 4);
      ctx.stroke();
    });
    updateConfetti();
  }

  function updateConfetti(){
    confetti.forEach((c, i)=>{
      c.tiltAngle += c.tiltAngleIncrement;
      c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2;
      c.x += Math.sin(c.d);
      c.tilt = Math.sin(c.tiltAngle) * 15;

      if(c.y > canvas.height){
        confetti[i] = {
          x: Math.random() * canvas.width,
          y: -10,
          r: c.r,
          d: c.d,
          color: c.color,
          tilt: Math.random() * 10 - 10,
          tiltAngleIncrement: c.tiltAngleIncrement,
          tiltAngle: c.tiltAngle
        };
      }
    });
  }

  function animate(){
    drawConfetti();
    requestAnimationFrame(animate);
  }

  animate();
}

function showFinalScreen(totalTime){
  modeloSection.style.display = 'none';
  document.querySelector("header").style.display = "block";
  document.getElementById('ranking').style.display = 'block';
  finalScreen.classList.add('active');

  finalScore.textContent = "Pontua√ß√£o final: " + score + " pontos";
  finalTime.textContent = "Tempo total: " + totalTime + " segundos";

  // ----- Galeria din√¢mica -----
  const gallery = document.getElementById('final-gallery');
  gallery.innerHTML = ''; // limpa antes de preencher
  capturedImages.forEach(img => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <img src="${img.src}" alt="${img.emotion}">
      <div class="label">${emotionEmojis[img.emotion]} ${img.emotion.toUpperCase()}</div>
    `;
    gallery.appendChild(div);
  });
  startConfetti();

}

document.addEventListener('DOMContentLoaded', () => {
  const rankingList = document.getElementById('ranking-list');
  const usernameInput = document.getElementById('username');
  let lastRanking = [];

  function saveRanking() {
  const username = usernameInput.value.trim();
  const score = 0; // coloca 0 ou a pontua√ß√£o que voc√™ quiser definir manualmente
  if (!username) return alert('Digite seu nome!');

  let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
  ranking.push({ name: username, score: score });
  ranking.sort((a, b) => b.score - a.score);
  localStorage.setItem('ranking', JSON.stringify(ranking.slice(0, 5))); // mant√©m top 5
  renderRanking();

  
}

  // Renderiza o ranking
  function renderRanking() {
    let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
    rankingList.innerHTML = '';

    ranking.forEach((item, i) => {
      const li = document.createElement('li');

      // Medals e cores para os 3 primeiros
      if (i === 0) li.classList.add('gold');
      else if (i === 1) li.classList.add('silver');
      else if (i === 2) li.classList.add('bronze');

      let medal = '';
      if (i === 0) medal = 'ü•á ';
      else if (i === 1) medal = 'ü•à ';
      else if (i === 2) medal = 'ü•â ';

      li.innerHTML = `${medal}${i + 1}¬∫ - ${item.name}: ${item.score} pts`;

      // Anima√ß√£o de subida
      if (lastRanking.length > 0) {
        const oldIndex = lastRanking.findIndex(e => e.name === item.name);
        if (oldIndex > i) {
          li.classList.add('up');
          setTimeout(() => li.classList.remove('up'), 700);
        }
      }
      function updateRanking(username, newScore) {
  let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');

  // Procura se o usu√°rio j√° existe
  const existing = ranking.find(item => item.name === username);

  if (existing) {
    // Atualiza s√≥ se a nova pontua√ß√£o for maior
    if (newScore > existing.score) existing.score = newScore;
  } else {
    ranking.push({ name: username, score: newScore });
  }

  // Ordena do maior para o menor e mant√©m top 5
  ranking.sort((a, b) => b.score - a.score);
  localStorage.setItem('ranking', JSON.stringify(ranking.slice(0, 5)));
  renderRanking();
}


      // Bot√£o remover
      const removeSpan = document.createElement('span');
      removeSpan.textContent = '[remover]';
      removeSpan.classList.add('remove');
      removeSpan.onclick = () => {
        li.classList.add('removing'); // anima√ß√£o de sa√≠da
        setTimeout(() => {
          ranking.splice(i, 1);
          localStorage.setItem('ranking', JSON.stringify(ranking));
          renderRanking();
        }, 400);
      };

      li.appendChild(removeSpan);
      rankingList.appendChild(li);
    });

    lastRanking = [...ranking]; // atualiza ranking antigo
  }

  // Renderiza ao carregar
  renderRanking();
});

// Carrossel final com loop infinito
let idx = 0;
function updateCarousel(n){
  const items = finalCarouselTrack.children;
  if(!items.length) return;
  idx = (n+items.length)%items.length;
  const offset = -idx*230;
  finalCarouselTrack.style.transform = `translateX(${offset}px)`;
  // marcar central
  for(let i=0;i<items.length;i++){
    const img = items[i].querySelector('img');
    img.classList.toggle('active',i===idx);
  }
}
carouselPrev.onclick = ()=>{ updateCarousel(idx-1); clickSound.play(); };
carouselNext.onclick = ()=>{ updateCarousel(idx+1); clickSound.play(); };
setInterval(()=>{ updateCarousel(idx+1); },4000);

</script>
<script>
// ------------------- NOVO PARA ADICIONAR -------------------
const rankingList = document.getElementById('ranking-list');
const usernameInput = document.getElementById('username');
let lastRanking = [];

function updateRanking(username, score) {
  if (!username) return;
  const timestamp = Date.now();
  let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');

  const existing = ranking.find(item => item.name === username);
  if (existing) {
    if (score > existing.score || (score === existing.score && timestamp < existing.timestamp)) {
      existing.score = score;
      existing.timestamp = timestamp;
    }
  } else {
    ranking.push({ name: username, score: score, timestamp });
  }

  ranking.sort((a,b) => b.score - a.score || a.timestamp - b.timestamp);
  localStorage.setItem('ranking', JSON.stringify(ranking.slice(0,5)));
  renderRanking();
}

function renderRanking() {
  let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
  rankingList.innerHTML = '';
  ranking.forEach((item,i) => {
    const li = document.createElement('li');

    if (i === 0) li.classList.add('gold');
    else if (i === 1) li.classList.add('silver');
    else if (i === 2) li.classList.add('bronze');

    let medal = i === 0 ? 'ü•á ' : i === 1 ? 'ü•à ' : i === 2 ? 'ü•â ' : '';
    li.innerHTML = `${medal}${i+1}¬∫ - ${item.name}: ${item.score} pts`;

    const removeSpan = document.createElement('span');
    removeSpan.textContent = '[remover]';
    removeSpan.classList.add('remove');
    removeSpan.onclick = () => {
      li.classList.add('removing');
      setTimeout(() => {
        ranking.splice(i,1);
        localStorage.setItem('ranking', JSON.stringify(ranking));
        renderRanking();
      }, 400);
    };

    li.appendChild(removeSpan);
    rankingList.appendChild(li);
  });

  lastRanking = [...ranking];
}

// Esconde ranking ao abrir webcam
document.getElementById('start-btn').addEventListener('click', () => {
  document.getElementById('ranking').style.display = 'none';
  init(); // sua fun√ß√£o da webcam
});

// Mostra ranking ao terminar teste
function showResults(finalScore) {
  const username = usernameInput.value.trim();
  updateRanking(username, finalScore);
  document.getElementById('ranking').style.display = 'block';
}

window.showResults = showResults;
renderRanking();
// ------------------- FIM NOVO -------------------
</script>

</body>
</html>
